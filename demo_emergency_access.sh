#!/bin/bash
# 緊急管理者アクセス - 使用例デモンストレーション

echo "======================================================================"
echo "🔓 緊急管理者アクセス機能 - 使用例デモンストレーション"
echo "======================================================================"
echo ""
echo "この機能は、すべての管理者アカウントにログインできない場合に"
echo "管理者権限を復旧するための緊急アクセス機能です。"
echo ""

# ステップ 1: 環境変数の設定
echo "📋 ステップ 1: 環境変数の設定"
echo "----------------------------------------------------------------------"
echo ".env ファイルに以下を追加："
echo ""
echo "EMERGENCY_ADMIN_KEY=your-secure-random-key-12345"
echo ""
echo "⚠️  強力なランダムな文字列を使用してください（最低32文字以上推奨）"
echo ""

# ステップ 2: サーバーの起動
echo "📋 ステップ 2: サーバーの起動"
echo "----------------------------------------------------------------------"
echo "$ npm start"
echo ""

# ステップ 3: API エンドポイントの呼び出し
echo "📋 ステップ 3: API エンドポイントの呼び出し"
echo "----------------------------------------------------------------------"
echo "管理者権限を付与したいユーザーに対して以下のコマンドを実行："
echo ""
echo 'curl -X POST http://localhost:8080/api/system-settings/emergency-admin-access \'
echo '  -H "Content-Type: application/json" \'
echo '  -d '"'"'{'
echo '    "targetUser": "@username",'
echo '    "emergencyKey": "your-secure-random-key-12345"'
echo '  }'"'"
echo ""

# 成功レスポンスの例
echo "📋 成功レスポンスの例"
echo "----------------------------------------------------------------------"
echo '{'
echo '  "success": true,'
echo '  "message": "管理者権限を @username に付与しました",'
echo '  "targetUser": "@username",'
echo '  "grantedBy": "EMERGENCY_KEY",'
echo '  "warning": "この操作は緊急管理者キーを使用して実行されました。..."'
echo '}'
echo ""

# セキュリティのヒント
echo "🔒 セキュリティのヒント"
echo "----------------------------------------------------------------------"
echo "1. この機能は緊急時のみ使用してください"
echo "2. 使用後は必ず EMERGENCY_ADMIN_KEY を新しい値に変更してください"
echo "3. キーは安全に保管し、決して公開しないでください"
echo "4. この機能を無効にする場合は、環境変数を削除または空にしてください"
echo ""

# トラブルシューティング
echo "🔧 トラブルシューティング"
echo "----------------------------------------------------------------------"
echo "• エラー「緊急管理者キーが無効です」"
echo "  → .env ファイルに EMERGENCY_ADMIN_KEY が正しく設定されているか確認"
echo "  → サーバーを再起動して環境変数を再読み込み"
echo ""
echo "• エラー「指定されたユーザーが見つかりません」"
echo "  → ユーザー名またはメールアドレスが正しいか確認"
echo "  → ハンドル形式の場合は @ が含まれているか確認"
echo ""
echo "• エラー「指定されたユーザーは既に管理者です」"
echo "  → ユーザーは既に管理者権限を持っています"
echo "  → 別のユーザーに権限を付与するか、既存の管理者でログインを試みてください"
echo ""

echo "======================================================================"
echo "📖 詳細なドキュメント: EMERGENCY_ADMIN_ACCESS.md"
echo "======================================================================"
