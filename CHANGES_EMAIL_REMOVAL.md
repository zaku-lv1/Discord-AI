# メールアドレスシステム廃止とアクティブ状態削除

## 概要
このアップデートでは、メールアドレスシステムの使用を廃止し、ユーザー名とパスワードのみで認証できるようにしました。また、ユーザープロファイルから「アクティブ」ステータス表示を削除しました。

## 変更点

### UI変更

1. **ログインフォーム**
   - ラベル変更: 「ハンドル名またはメールアドレス」→「ユーザー名」
   - プレースホルダー変更: 「username、@username、または email@domain.com」→「usernameまたは@username」

2. **新規登録フォーム**
   - メールアドレス入力フィールドを削除
   - 必須項目: ユーザー名、パスワード、招待コード

3. **プロファイルページ**
   - メールアドレス表示フィールドを削除
   - 「アクティブ」ステータス表示を削除

4. **管理者設定ページ**
   - オーナーセットアップからメールアドレス入力を削除
   - 管理者権限付与でメールアドレスの代わりにユーザー名を使用

5. **削除された機能**
   - パスワード再設定機能（メール送信が必要なため）
   - メール認証待ち画面
   - メール認証再送信機能

### バックエンド変更

1. **認証サービス (`services/auth.js`)**
   - `createLocalUser`: メールアドレスをオプションに変更。未指定の場合は `username@local.system` を自動生成
   - メールアドレスの重複チェックを削除
   - メール認証フローを完全にスキップ
   - ユーザーは作成時に自動的に `verified: true` に設定
   - `findLocalUser`: メールアドレスでの検索を削除し、ユーザー名/ハンドルのみで検索
   - メールサービスの初期化をスキップ

2. **登録ルート (`routes/auth.js`)**
   - `/register` エンドポイント: メールアドレスパラメータを削除
   - バリデーション: メールアドレスチェックを削除

3. **オーナーセットアップルート (`routes/owner-setup.js`)**
   - メールアドレスパラメータを削除
   - バリデーション: メールアドレス必須チェックを削除

4. **システム設定ルート (`routes/system-settings.js`)**
   - `/grant-admin` エンドポイント: メールアドレスの代わりにユーザー名を使用
   - ユーザー名からメールアドレスを内部的に解決（後方互換性のため）

### フロントエンド変更

1. **アプリケーションスクリプト (`public/app.js`)**
   - 登録フォーム送信: メールアドレスフィールドの削除
   - メール認証待ち画面表示のロジックを削除
   - プロファイル更新: メールアドレス関連の処理を削除
   - 管理者権限付与: メールアドレスの代わりにユーザー名を使用

## 後方互換性

- 既存のユーザーはメールアドレスを持ったままですが、ログイン時にメールアドレスは使用されません
- 内部的には、システムが各ユーザーにダミーのメールアドレス（`username@local.system`）を割り当てます
- 既存のコードでメールアドレスを使用している部分は動作し続けます

## 影響を受ける機能

### 削除された機能
- メールアドレスでのログイン
- メール認証
- パスワード再設定（メール送信が必要）
- メール通知

### 変更なし
- ユーザー名/ハンドルでのログイン
- パスワード認証
- ロール管理
- 招待コードシステム
- Discord OAuth統合（オプション）

## 今後の作業

メールアドレスシステムが完全に削除されたため、以下の点を検討してください：

1. パスワードリセット機能の代替手段（管理者によるリセットなど）
2. 通知システムの代替手段（システム内通知など）
3. 既存ユーザーのメールアドレスデータの取り扱い

## テスト項目

- [x] ユーザー名のみでの新規登録
- [x] ユーザー名でのログイン
- [x] @username形式でのログイン
- [ ] 管理者権限の付与（ユーザー名指定）
- [ ] プロファイルページの表示
- [ ] オーナーセットアップフロー
